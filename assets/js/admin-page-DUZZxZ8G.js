import{r as e,j as s,e as a,f as r,aJ as t,aG as i}from"./react-vendor-BC-NryIe.js";import{e as n,h as l,i as d,U as c,H as o,S as m,M as u,d as x,j as h,k as j,m as f,n as p,o as b,B as v,F as N,D as g,p as y,q as w,r as S,s as C,t as T,v as I,w as k}from"./index-CRa19pyD.js";import{I as q}from"./input-BNWx-9ZS.js";import{u as D}from"./router-MOUxwqPK.js";import"./vendor-BQl0nyRy.js";import"./radix-ui-ByoYm48K.js";import"./forms-Cf6uUqBP.js";const R=e.forwardRef(({className:e,...a},r)=>s.jsx("div",{className:"relative w-full overflow-auto",children:s.jsx("table",{ref:r,className:n("w-full caption-bottom text-sm",e),...a})}));R.displayName="Table";const E=e.forwardRef(({className:e,...a},r)=>s.jsx("thead",{ref:r,className:n("[&_tr]:border-b",e),...a}));E.displayName="TableHeader";const F=e.forwardRef(({className:e,...a},r)=>s.jsx("tbody",{ref:r,className:n("[&_tr:last-child]:border-0",e),...a}));F.displayName="TableBody";e.forwardRef(({className:e,...a},r)=>s.jsx("tfoot",{ref:r,className:n("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";const K=e.forwardRef(({className:e,...a},r)=>s.jsx("tr",{ref:r,className:n("border-b transition-colors hover:bg-muted/30 data-[state=selected]:bg-muted",e),...a}));K.displayName="TableRow";const M=e.forwardRef(({className:e,...a},r)=>s.jsx("th",{ref:r,className:n("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));M.displayName="TableHead";const A=e.forwardRef(({className:e,...a},r)=>s.jsx("td",{ref:r,className:n("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));A.displayName="TableCell";e.forwardRef(({className:e,...a},r)=>s.jsx("caption",{ref:r,className:n("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption";const L=e.forwardRef(({className:e,...a},r)=>s.jsx("textarea",{className:n("flex min-h-[80px] w-full rounded-md border border-transparent bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-white focus-visible:border-2 focus-visible:ring-2 focus-visible:ring-white/60 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));L.displayName="Textarea";const O=()=>{const{toast:n}=l(),{user:O}=d(),[P,G]=D(),[H,V]=e.useState(!1),[Q,$]=e.useState(""),[B,U]=e.useState(!1),[_,z]=e.useState(null),[J,W]=e.useState(""),[X,Y]=e.useState(""),{data:Z=[],isLoading:ee}=a({queryKey:["/api/categories"],queryFn:async()=>(await I("GET","/api/categories")).json()}),{data:se=[],isLoading:ae}=a({queryKey:["/api/services"],queryFn:async()=>(await I("GET","/api/services")).json()}),{data:re=null,isLoading:te}=a({queryKey:["/api/status-summary"],queryFn:async()=>(await I("GET","/api/status-summary")).json()}),ie=r({mutationFn:async({serviceId:e,status:s})=>await I("PATCH",`/api/services/${e}/status`,{status:s}),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/services"]}),k.invalidateQueries({queryKey:["/api/status-summary"]}),n({title:"Status updated",description:"The service status has been updated successfully."})},onError:e=>{n({title:"Error",description:e.message,variant:"destructive"})}}),ne=r({mutationFn:async e=>await I("POST",`/api/services/${e.serviceId}/incidents`,e),onSuccess:()=>{U(!1),W(""),Y(""),z(null),k.invalidateQueries({queryKey:["/api/services"]}),n({title:"Incident created",description:"The incident has been created successfully."})},onError:e=>{n({title:"Error",description:e.message,variant:"destructive"})}});t.useEffect(()=>{O?O.role!==c.ADMIN&&G("/"):G("/auth")},[O,G]);const le=()=>V(!H),de=async(e,s)=>{await ie.mutate({serviceId:e,status:s})},ce=se.filter(e=>e.name.toLowerCase().includes(Q.toLowerCase()));return ae||ee||te?s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:s.jsx(i,{className:"w-8 h-8 animate-spin text-primary"})}):O&&O.role===c.ADMIN?s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(o,{services:se,onMenuToggle:le,onSearch:e=>{$(e)}}),s.jsxs("div",{className:"flex min-h-[calc(100vh-64px)]",children:[s.jsx(m,{categories:Z,statusSummary:re}),s.jsx(u,{isOpen:H,onClose:le,categories:Z,statusSummary:re}),s.jsxs("main",{className:"flex-1 pb-12 lg:ml-64",children:[s.jsx("div",{className:"p-4 border-b md:p-6 border-border",children:s.jsxs("div",{className:"container mx-auto",children:[s.jsx("h1",{className:"mb-2 text-2xl font-bold",children:"Admin Dashboard"}),s.jsx("p",{className:"text-muted-foreground",children:"Manage service statuses and incidents"})]})}),s.jsx("div",{className:"container px-4 py-6 mx-auto",children:s.jsxs("div",{className:"p-4 mb-8 border rounded-lg bg-card border-border",children:[s.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"Service Status Management"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(R,{children:[s.jsx(E,{children:s.jsxs(K,{children:[s.jsx(M,{children:"Service"}),s.jsx(M,{children:"Category"}),s.jsx(M,{children:"Current Status"}),s.jsx(M,{children:"Actions"})]})}),s.jsx(F,{children:ce.map(e=>{const a=Z.find(s=>s.id===e.categoryId);return s.jsxs(K,{children:[s.jsx(A,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("i",{className:`${e.logo} text-lg mr-2`}),s.jsx("span",{children:e.name})]})}),s.jsx(A,{children:a?.name||"Unknown"}),s.jsx(A,{children:s.jsx(x,{status:e.status})}),s.jsx(A,{children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(h,{defaultValue:e.status,onValueChange:s=>de(e.id,s),disabled:ie.isPending,children:[s.jsx(j,{className:"w-32",children:s.jsx(f,{placeholder:"Status"})}),s.jsxs(p,{children:[s.jsx(b,{value:"operational",children:"Operational"}),s.jsx(b,{value:"degraded",children:"Degraded"}),s.jsx(b,{value:"down",children:"Down"})]})]}),s.jsxs(v,{variant:"outline",size:"sm",onClick:()=>(e=>{z(e),U(!0)})(e),children:[s.jsx("i",{className:"mr-1 fas fa-exclamation-triangle"})," New Incident"]})]})})]},e.id)})})]})})]})})]})]}),s.jsx(N,{}),s.jsx(g,{open:B,onOpenChange:U,children:s.jsxs(y,{className:"border-border",children:[s.jsxs(w,{children:[s.jsx(S,{children:"New Incident"}),s.jsxs(C,{className:"text-muted-foreground",children:["Create a new incident for ",_?.name]})]}),s.jsxs("div",{className:"py-4 space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Title"}),s.jsx(q,{placeholder:"Incident title",value:J,onChange:e=>W(e.target.value)})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Description"}),s.jsx(L,{placeholder:"Describe the incident...",value:X,onChange:e=>Y(e.target.value),rows:4})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Status"}),s.jsxs(h,{defaultValue:_?.status,onValueChange:e=>_&&de(_.id,e),children:[s.jsx(j,{children:s.jsx(f,{placeholder:"Status"})}),s.jsxs(p,{children:[s.jsx(b,{value:"operational",children:"Operational"}),s.jsx(b,{value:"degraded",children:"Degraded"}),s.jsx(b,{value:"down",children:"Down"})]})]})]})]}),s.jsxs(T,{children:[s.jsx(v,{variant:"outline",onClick:()=>U(!1),children:"Cancel"}),s.jsx(v,{onClick:async()=>{_&&J&&X&&await ne.mutate({serviceId:_.id,title:J,description:X})},disabled:ne.isPending||!J||!X,children:ne.isPending?"Creating...":"Create Incident"})]})]})})]}):null};export{O as default};
