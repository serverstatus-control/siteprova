import{aJ as e,j as t,r as s,a9 as a}from"./react-vendor-BTtMfXVs.js";import{c as i}from"./router-BGylx-d0.js";import{u as r,H as n,S as l,M as d,g as o,a as c,F as m}from"./index-D_RO19YF.js";import{j as x,k as g,l as h,r as u,s as f,w as p}from"./ui-components-DRL8qVLK.js";import{aj as j,a3 as b,a4 as y,a5 as v,a6 as N,a7 as w,a8 as T,a9 as k,aa as S,ab as $}from"./vendor-BOHXtaP9.js";import"./radix-ui-ByoYm48K.js";import"./forms-eZP0p4fM.js";const P={it:$,en:S,es:k,fr:T,de:w,pt:N,ru:v,zh:y,ja:b},C=({history:s})=>{const{t:a,language:i}=r(),n=[...s].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[l,d]=e.useState(!1);return e.useEffect(()=>{const e=setTimeout(()=>d(!0),50);return()=>clearTimeout(e)},[]),t.jsx(x,{children:t.jsx("div",{className:"space-y-3",children:n.map((e,s)=>{const a=(r=e.status,n=e.uptimePercentage,"down"===r?"bg-danger":"degraded"===r||n<95?"bg-warning":"bg-success");var r,n;const d=((e,t)=>"down"===e?"text-danger":"degraded"===e||t<95?"text-warning":"text-success")(e.status,e.uptimePercentage),o=(e=>{const t=new Date(e);return j(t,"d MMM HH:mm",{locale:P[i]||S})})(e.date),c=`${e.uptimePercentage}% uptime - ${e.status.charAt(0).toUpperCase()+e.status.slice(1)}`;return t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-xs text-gray-400 w-20",children:o}),t.jsxs(g,{children:[t.jsx(h,{asChild:!0,children:t.jsx("div",{className:"flex-1 h-3 rounded overflow-hidden bg-dark-light cursor-pointer",children:t.jsx("div",{className:`${a} h-full rounded transition-all duration-700 ease-out`,style:{width:l?`${e.uptimePercentage}%`:"0%"},"aria-hidden":!0})})}),t.jsx(u,{side:"top",children:c})]}),t.jsxs("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${d} bg-opacity-90 bg-gray-800 text-white font-semibold shadow`,children:[e.uptimePercentage,"%"]})]},s)})})})},M=({history:e,className:a=""})=>{const i=s.useRef(null),{t:n}=r(),l=s.useMemo(()=>{const t=(new Date).getTime()-864e5,s=e.map(e=>({...e,dateObj:new Date(e.date)})).filter(e=>e.dateObj.getTime()>=t).sort((e,t)=>e.dateObj.getTime()-t.dateObj.getTime()),a=new Map;for(const e of s){const t=new Date(e.dateObj);t.setMinutes(0,0,0),a.set(t.getTime(),{time:new Date(t),uptime:e.uptimePercentage,status:e.status})}return Array.from(a.values()).sort((e,t)=>e.time.getTime()-t.time.getTime())},[e]);return s.useEffect(()=>{const e=i.current;if(!e)return;const t=e.getBoundingClientRect();e.width=t.width*window.devicePixelRatio,e.height=t.height*window.devicePixelRatio;const s=e.getContext("2d");s&&s.scale(window.devicePixelRatio,window.devicePixelRatio),(()=>{const e=i.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const s=l,a=e.width,r=e.height,d=40,o=a-80,c=r-80;t.clearRect(0,0,a,r);const m="#9ca3af";t.fillStyle="#1a1a1a",t.fillRect(0,0,a,r),t.strokeStyle="#333333",t.lineWidth=1;for(let i=0;i<=4;i++){const e=d+c*i/4;t.beginPath(),t.moveTo(d,e),t.lineTo(a-d,e),t.stroke()}for(let i=0;i<=6;i++){const e=d+o*i/6;t.beginPath(),t.moveTo(e,d),t.lineTo(e,r-d),t.stroke()}if(!s.length)return t.fillStyle=m,t.font="13px Inter, sans-serif",t.textAlign="center",t.textBaseline="middle",void t.fillText(n.noHistoryAvailable,a/2,r/2);t.lineWidth=3,t.lineCap="round",t.lineJoin="round";const x=t.createLinearGradient(0,d,0,r-d);x.addColorStop(0,"#10b981"),x.addColorStop(.7,"#f59e0b"),x.addColorStop(1,"#ef4444"),t.strokeStyle=x,t.beginPath(),s.forEach((e,a)=>{const i=d+o*a/(s.length-1),n=r-d-c*e.uptime/100;0===a?t.moveTo(i,n):t.lineTo(i,n)}),t.stroke(),s.forEach((e,a)=>{const i=d+o*a/(s.length-1),n=r-d-c*e.uptime/100;let l="#10b981";"degraded"===e.status&&(l="#f59e0b"),"down"===e.status&&(l="#ef4444"),t.fillStyle=l,t.beginPath(),t.arc(i,n,4,0,2*Math.PI),t.fill(),t.strokeStyle="#ffffff",t.lineWidth=1,t.stroke()}),t.fillStyle=m,t.font="12px Inter, sans-serif",t.textAlign="right",t.textBaseline="middle";for(let i=0;i<=4;i++){const e=d+c*i/4,s=100-25*i;t.fillText(s+"%",30,e)}t.textAlign="center",t.textBaseline="top";for(let i=0;i<=6;i++){const e=d+o*i/6,a=Math.floor((s.length-1)*i/6),n=s[a].time.getHours().toString().padStart(2,"0")+":00";t.fillText(n,e,r-d+10)}t.fillStyle=m,t.font="bold 14px Inter, sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(n.uptimeHistory+" (24h)",d,10)})()},[l,n]),t.jsx("div",{className:`relative ${a}`,children:t.jsx("canvas",{ref:i,className:"w-full h-64 rounded-lg bg-gray-900 border border-gray-700",style:{width:"100%",height:"256px"}})})},R=()=>{const[e,x]=i("/services/:slug"),[g,h]=s.useState(!1),[u,b]=s.useState(""),{data:y=[],isLoading:v}=a({queryKey:["/api/categories"]}),{data:N=null,isLoading:w}=a({queryKey:["/api/status-summary"]}),{data:T,isLoading:k,error:S}=a({queryKey:[`/api/services/${x?.slug}`],enabled:!!x?.slug,refetchInterval:864e5,refetchOnWindowFocus:!1}),{data:$=[],isLoading:P}=a({queryKey:["/api/services"]}),{data:R=[],isLoading:H}=a({queryKey:[`/api/services/${T?.id}/history`],enabled:!!T?.id,refetchInterval:864e5,refetchOnWindowFocus:!1}),{data:D=[],isLoading:O}=a({queryKey:[`/api/services/${T?.id}/incidents`],enabled:!!T?.id}),A=()=>{h(!g)},{t:I,language:L}=r(),q=(e,t)=>{const s=j(new Date(e),"MMM d, yyyy - HH:mm",{locale:p[L]});return t?`${s} ${I.to||"to"} ${j(new Date(t),"HH:mm",{locale:p[L]})}`:`${s} ${I.toPresent||"to present"}`};if(v||w||k||H||O||P)return t.jsx("div",{className:"min-h-screen bg-dark flex items-center justify-center",children:t.jsx("div",{className:"text-white text-xl",children:I.loadingServices})});if(S||!T)return t.jsx("div",{className:"min-h-screen bg-dark flex items-center justify-center",children:t.jsx("div",{className:"text-white text-xl",children:"Service not found"})});const B=T.lastChecked?f(T.lastChecked,L):I.unknown||"Unknown";return t.jsxs("div",{className:"bg-dark text-gray-100 font-sans min-h-screen",children:[t.jsx(n,{onMenuToggle:A,onSearch:e=>{b(e)},services:$}),t.jsxs("div",{className:"flex min-h-[calc(100vh-64px)]",children:[t.jsx(l,{categories:y,statusSummary:N}),t.jsx(d,{isOpen:g,onClose:A,categories:y,statusSummary:N}),t.jsx("main",{className:"flex-1 lg:ml-64 pb-12",children:t.jsx("div",{className:"container mx-auto px-4 py-6",children:t.jsxs("div",{className:"mb-6",children:[t.jsxs("a",{href:"/",className:"text-primary hover:text-blue-400 mb-4 inline-flex items-center",children:[t.jsx("i",{className:"fas fa-arrow-left mr-2"}),"Back to Dashboard"]}),t.jsxs("div",{className:"bg-dark-light p-6 rounded-lg border border-dark-lighter mt-4",children:[t.jsxs("div",{className:"flex items-center mb-6",children:[t.jsx("div",{className:"w-16 h-16 bg-dark-lighter rounded-full flex items-center justify-center mr-6",children:t.jsx("i",{className:`${T.logo||o(T.name)} text-3xl`})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:T.name}),t.jsxs("div",{className:"flex items-center mt-2",children:[t.jsx(c,{status:T.status,className:"mr-3"}),t.jsxs("span",{className:"text-sm text-gray-400",children:[I.lastCheck,": ",B]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:I.currentStatus||"Current Status"}),t.jsx("div",{className:"bg-dark-lighter rounded-lg p-4",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1",children:I.responseTime||"Response Time"}),t.jsx("p",{className:"font-mono text-lg",children:"down"===T.status?"Timeout":`${T.responseTime}ms`})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1",children:I.uptime30d||"Uptime (30 days)"}),t.jsxs("p",{className:"font-mono text-lg",children:[T.uptimePercentage,"%"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1",children:I.lastOutage||"Last Outage"}),t.jsx("p",{className:"font-mono text-lg",children:D.length>0?f(D[0].startTime,L):I.noRecentOutages||"No recent outages"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-400 mb-1",children:I.avgResponse||"Avg. Response"}),t.jsx("p",{className:"font-mono text-lg",children:"down"===T.status?"N/A":`${Math.round(R.reduce((e,t)=>e+t.responseTime,0)/(R.length||1))}ms`})]})]})})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:I.uptimeHistory||"Uptime History"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-dark-lighter rounded-lg p-4",children:t.jsx(M,{history:R})}),t.jsxs("div",{className:"bg-dark-lighter rounded-lg p-4",children:[t.jsx("h3",{className:"text-sm font-medium mb-3 text-gray-400",children:"Cronologia Dettagliata"}),R.length>0?t.jsx(C,{history:R}):t.jsx("p",{className:"text-sm text-gray-400",children:I.noHistoryAvailable||"No history available"})]})]})]})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:I.recentIncidents||"Recent Incidents"}),t.jsx("div",{className:"bg-dark-lighter rounded-lg p-4",children:D.length>0?t.jsx("div",{className:"space-y-4",children:D.map(e=>t.jsx("div",{className:"pb-4 border-b border-gray-700 last:border-0 last:pb-0",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full bg-${"down"===e.status?"danger":"warning"} bg-opacity-20 text-${"down"===e.status?"danger":"warning"} mt-0.5 mr-3`,children:t.jsx("i",{className:`fas fa-${"down"===e.status?"exclamation-circle":"exclamation-triangle"} text-sm`})}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium mb-1",children:e.title}),t.jsx("p",{className:"text-sm text-gray-400 mb-2",children:e.description}),t.jsx("div",{className:"text-xs text-gray-500 font-mono",children:q(e.startTime,e.endTime)})]})]})},e.id))}):t.jsx("p",{className:"text-sm text-gray-400",children:I.noIncidentsReported||"No incidents reported"})})]})]})]})})})]}),t.jsx(m,{})]})};export{R as default};
