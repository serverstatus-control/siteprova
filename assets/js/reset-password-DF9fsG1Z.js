import{r as s,aL as e,j as r,aO as a,aP as t}from"./react-vendor-BCKZ37BP.js";import{u as o}from"./router-CS916hjU.js";import{t as i,o as n,s as d}from"./forms-B8vtVtS4.js";import{u as l,C as c,w as m,x as w,y as u,z as x,A as h,B as p}from"./index-CH5zmLRD.js";import{I as j}from"./input-0YXbuBY-.js";import"./vendor-C1u4FD2K.js";import"./radix-ui-ByoYm48K.js";const f=n({token:d().min(1),password:d().min(6,"La password deve essere almeno 6 caratteri"),confirmPassword:d().min(1)}).refine(s=>s.password===s.confirmPassword,{message:"Le password non corrispondono",path:["confirmPassword"]});function g(){const[n,d]=o(),g=s.useMemo(()=>new URLSearchParams(window.location.search).get("token")||"",[]),{t:b}=l(),[N,v]=s.useState(null),[P,y]=s.useState(!1),[k,S]=s.useState(!1),[C,T]=s.useState(!1),L=e({resolver:i(f),defaultValues:{token:g,password:"",confirmPassword:""}});s.useEffect(()=>{g&&L.setValue("token",g)},[g]);return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:r.jsx("div",{className:"w-full max-w-md",children:r.jsxs(c,{children:[r.jsxs(m,{children:[r.jsx(w,{children:b?.resetPasswordTitle||"Reset Password"}),r.jsx(u,{children:b?.resetPasswordSubtitle||"Inserisci la nuova password"})]}),r.jsxs("form",{onSubmit:L.handleSubmit(async s=>{y(!0),v(null);try{const e=await fetch("/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:s.token,password:s.password})}),r=await e.json().catch(()=>({}));e.ok?(v(b?.success||"Password aggiornata con successo. Verrai reindirizzato alla schermata di login."),setTimeout(()=>d("/auth"),1500)):v(r?.message||b?.error||"Errore durante il reset della password")}catch(e){v(b?.error||"Errore di rete")}finally{y(!1)}}),children:[r.jsxs(x,{className:"space-y-4",children:[r.jsx(j,{type:"hidden",...L.register("token")}),r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1 text-sm",children:b?.newPassword||"Nuova password"}),r.jsxs("div",{className:"relative",children:[r.jsx(j,{type:k?"text":"password",...L.register("password")}),r.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-muted-foreground hover:text-foreground",onClick:()=>S(s=>!s),"aria-label":k?b?.hidePassword||"Nascondi password":b?.showPassword||"Mostra password",children:k?r.jsx(a,{className:"w-4 h-4"}):r.jsx(t,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"text-sm text-red-400",children:L.formState.errors.password?.message})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1 text-sm",children:b?.confirmPassword||"Conferma password"}),r.jsxs("div",{className:"relative",children:[r.jsx(j,{type:C?"text":"password",...L.register("confirmPassword")}),r.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-muted-foreground hover:text-foreground",onClick:()=>T(s=>!s),"aria-label":C?b?.hidePassword||"Nascondi password":b?.showPassword||"Mostra password",children:C?r.jsx(a,{className:"w-4 h-4"}):r.jsx(t,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"text-sm text-red-400",children:L.formState.errors.confirmPassword?.message})]}),!g&&r.jsxs("div",{className:"text-sm text-muted-foreground",children:[b?.noValidToken||"Non hai un token valido?"," ",r.jsx("button",{type:"button",className:"text-orange-500 hover:underline",onClick:()=>d("/forgot-password"),children:b?.requestNewReset||"Richiedi un nuovo link di reset"})]}),N&&r.jsx("div",{className:"text-sm text-gray-300 whitespace-pre-wrap break-words",children:N})]}),r.jsx(h,{children:r.jsx(p,{type:"submit",className:"w-full",disabled:P,children:P?b?.sending||"Invio...":b?.updatePassword||"Aggiorna Password"})})]})]})})})}export{g as default};
//# sourceMappingURL=reset-password-DF9fsG1Z.js.map
