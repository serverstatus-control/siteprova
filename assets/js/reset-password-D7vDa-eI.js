import{r as s,aM as e,j as r,aP as a,aQ as o}from"./react-vendor-BTtMfXVs.js";import{u as t}from"./router-BGylx-d0.js";import{t as i,o as n,s as d}from"./forms-eZP0p4fM.js";import{C as l,J as c,K as m,M as w,a as u,I as x,N as h,B as p}from"./ui-components-DRL8qVLK.js";import{u as j}from"./index-D_RO19YF.js";import"./vendor-BOHXtaP9.js";import"./radix-ui-ByoYm48K.js";const f=n({token:d().min(1),password:d().min(6,"La password deve essere almeno 6 caratteri"),confirmPassword:d().min(1)}).refine(s=>s.password===s.confirmPassword,{message:"Le password non corrispondono",path:["confirmPassword"]});function g(){const[n,d]=t(),g=s.useMemo(()=>new URLSearchParams(window.location.search).get("token")||"",[]),{t:N}=j(),[b,v]=s.useState(null),[P,k]=s.useState(!1),[y,S]=s.useState(!1),[C,M]=s.useState(!1),T=e({resolver:i(f),defaultValues:{token:g,password:"",confirmPassword:""}});return s.useEffect(()=>{g&&T.setValue("token",g)},[g]),r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:r.jsx("div",{className:"w-full max-w-md",children:r.jsxs(l,{children:[r.jsxs(c,{children:[r.jsx(m,{children:N?.resetPasswordTitle||"Reset Password"}),r.jsx(w,{children:N?.resetPasswordSubtitle||"Inserisci la nuova password"})]}),r.jsxs("form",{onSubmit:T.handleSubmit(async s=>{k(!0),v(null);try{const e=await fetch("/api/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:s.token,password:s.password})}),r=await e.json().catch(()=>({}));e.ok?(v(N?.success||"Password aggiornata con successo. Verrai reindirizzato alla schermata di login."),setTimeout(()=>d("/auth"),1500)):v(r?.message||N?.error||"Errore durante il reset della password")}catch(e){v(N?.error||"Errore di rete")}finally{k(!1)}}),children:[r.jsxs(u,{className:"space-y-4",children:[r.jsx(x,{type:"hidden",...T.register("token")}),r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1 text-sm",children:N?.newPassword||"Nuova password"}),r.jsxs("div",{className:"relative",children:[r.jsx(x,{type:y?"text":"password",...T.register("password")}),r.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-muted-foreground hover:text-foreground",onClick:()=>S(s=>!s),"aria-label":y?N?.hidePassword||"Nascondi password":N?.showPassword||"Mostra password",children:y?r.jsx(a,{className:"w-4 h-4"}):r.jsx(o,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"text-sm text-red-400",children:T.formState.errors.password?.message})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block mb-1 text-sm",children:N?.confirmPassword||"Conferma password"}),r.jsxs("div",{className:"relative",children:[r.jsx(x,{type:C?"text":"password",...T.register("confirmPassword")}),r.jsx("button",{type:"button",className:"absolute inset-y-0 right-2 flex items-center text-muted-foreground hover:text-foreground",onClick:()=>M(s=>!s),"aria-label":C?N?.hidePassword||"Nascondi password":N?.showPassword||"Mostra password",children:C?r.jsx(a,{className:"w-4 h-4"}):r.jsx(o,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"text-sm text-red-400",children:T.formState.errors.confirmPassword?.message})]}),!g&&r.jsxs("div",{className:"text-sm text-muted-foreground",children:[N?.noValidToken||"Non hai un token valido?"," ",r.jsx("button",{type:"button",className:"text-orange-500 hover:underline",onClick:()=>d("/forgot-password"),children:N?.requestNewReset||"Richiedi un nuovo link di reset"})]}),b&&r.jsx("div",{className:"text-sm text-gray-300 whitespace-pre-wrap break-words",children:b})]}),r.jsx(h,{children:r.jsx(p,{type:"submit",className:"w-full",disabled:P,children:P?N?.sending||"Invio...":N?.updatePassword||"Aggiorna Password"})})]})]})})})}export{g as default};
