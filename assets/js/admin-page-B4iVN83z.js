import{r as e,a9 as s,aa as a,aJ as i,j as n,aI as r}from"./react-vendor-BTtMfXVs.js";import{b as t,U as c,H as l,S as d,M as o,a as u,F as m,q as x,c as h}from"./index-C5MS0an8.js";import{u as j,x as p,y as v,z as g,A as y,E as f,F as b,S as N,f as S,g as w,h as C,i as I,B as q,D,b as E,c as T,d as F,e as k,I as A,G as K,H as M}from"./ui-components-DRL8qVLK.js";import{u as L}from"./router-BGylx-d0.js";import"./vendor-BOHXtaP9.js";import"./radix-ui-ByoYm48K.js";import"./forms-eZP0p4fM.js";const O=()=>{const{toast:O}=j(),{user:P}=t(),[G,V]=L(),[H,Q]=e.useState(!1),[$,z]=e.useState(""),[U,B]=e.useState(!1),[J,R]=e.useState(null),[W,X]=e.useState(""),[Y,Z]=e.useState(""),{data:_=[],isLoading:ee}=s({queryKey:["/api/categories"],queryFn:async()=>(await h("GET","/api/categories")).json()}),{data:se=[],isLoading:ae}=s({queryKey:["/api/services"],queryFn:async()=>(await h("GET","/api/services")).json()}),{data:ie=null,isLoading:ne}=s({queryKey:["/api/status-summary"],queryFn:async()=>(await h("GET","/api/status-summary")).json()}),re=a({mutationFn:async({serviceId:e,status:s})=>await h("PATCH",`/api/services/${e}/status`,{status:s}),onSuccess:()=>{x.invalidateQueries({queryKey:["/api/services"]}),x.invalidateQueries({queryKey:["/api/status-summary"]}),O({title:"Status updated",description:"The service status has been updated successfully."})},onError:e=>{O({title:"Error",description:e.message,variant:"destructive"})}}),te=a({mutationFn:async e=>await h("POST",`/api/services/${e.serviceId}/incidents`,e),onSuccess:()=>{B(!1),X(""),Z(""),R(null),x.invalidateQueries({queryKey:["/api/services"]}),O({title:"Incident created",description:"The incident has been created successfully."})},onError:e=>{O({title:"Error",description:e.message,variant:"destructive"})}});i.useEffect(()=>{P?P.role!==c.ADMIN&&V("/"):V("/auth")},[P,V]);const ce=()=>Q(!H),le=async(e,s)=>{await re.mutate({serviceId:e,status:s})},de=se.filter(e=>e.name.toLowerCase().includes($.toLowerCase()));return ae||ee||ne?n.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:n.jsx(r,{className:"w-8 h-8 animate-spin text-primary"})}):P&&P.role===c.ADMIN?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(l,{services:se,onMenuToggle:ce,onSearch:e=>{z(e)}}),n.jsxs("div",{className:"flex min-h-[calc(100vh-64px)]",children:[n.jsx(d,{categories:_,statusSummary:ie}),n.jsx(o,{isOpen:H,onClose:ce,categories:_,statusSummary:ie}),n.jsxs("main",{className:"flex-1 pb-12 lg:ml-64",children:[n.jsx("div",{className:"p-4 border-b md:p-6 border-border",children:n.jsxs("div",{className:"container mx-auto",children:[n.jsx("h1",{className:"mb-2 text-2xl font-bold",children:"Admin Dashboard"}),n.jsx("p",{className:"text-muted-foreground",children:"Manage service statuses and incidents"})]})}),n.jsx("div",{className:"container px-4 py-6 mx-auto",children:n.jsxs("div",{className:"p-4 mb-8 border rounded-lg bg-card border-border",children:[n.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"Service Status Management"}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs(p,{children:[n.jsx(v,{children:n.jsxs(g,{children:[n.jsx(y,{children:"Service"}),n.jsx(y,{children:"Category"}),n.jsx(y,{children:"Current Status"}),n.jsx(y,{children:"Actions"})]})}),n.jsx(f,{children:de.map(e=>{const s=_.find(s=>s.id===e.categoryId);return n.jsxs(g,{children:[n.jsx(b,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("i",{className:`${e.logo} text-lg mr-2`}),n.jsx("span",{children:e.name})]})}),n.jsx(b,{children:s?.name||"Unknown"}),n.jsx(b,{children:n.jsx(u,{status:e.status})}),n.jsx(b,{children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(N,{defaultValue:e.status,onValueChange:s=>le(e.id,s),disabled:re.isPending,children:[n.jsx(S,{className:"w-32",children:n.jsx(w,{placeholder:"Status"})}),n.jsxs(C,{children:[n.jsx(I,{value:"operational",children:"Operational"}),n.jsx(I,{value:"degraded",children:"Degraded"}),n.jsx(I,{value:"down",children:"Down"})]})]}),n.jsxs(q,{variant:"outline",size:"sm",onClick:()=>(e=>{R(e),B(!0)})(e),children:[n.jsx("i",{className:"mr-1 fas fa-exclamation-triangle"})," New Incident"]})]})})]},e.id)})})]})})]})})]})]}),n.jsx(m,{}),n.jsx(D,{open:U,onOpenChange:B,children:n.jsxs(E,{className:"border-border",children:[n.jsxs(T,{children:[n.jsx(F,{children:"New Incident"}),n.jsxs(k,{className:"text-muted-foreground",children:["Create a new incident for ",J?.name]})]}),n.jsxs("div",{className:"py-4 space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Title"}),n.jsx(A,{placeholder:"Incident title",value:W,onChange:e=>X(e.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Description"}),n.jsx(K,{placeholder:"Describe the incident...",value:Y,onChange:e=>Z(e.target.value),rows:4})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Status"}),n.jsxs(N,{defaultValue:J?.status,onValueChange:e=>J&&le(J.id,e),children:[n.jsx(S,{children:n.jsx(w,{placeholder:"Status"})}),n.jsxs(C,{children:[n.jsx(I,{value:"operational",children:"Operational"}),n.jsx(I,{value:"degraded",children:"Degraded"}),n.jsx(I,{value:"down",children:"Down"})]})]})]})]}),n.jsxs(M,{children:[n.jsx(q,{variant:"outline",onClick:()=>B(!1),children:"Cancel"}),n.jsx(q,{onClick:async()=>{J&&W&&Y&&await te.mutate({serviceId:J.id,title:W,description:Y})},disabled:te.isPending||!W||!Y,children:te.isPending?"Creating...":"Create Incident"})]})]})})]}):null};export{O as default};
